<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esc√°ner de Licencias USA - PDF417 Real</title>
    <link rel="stylesheet" href="styles.css">
    <!-- ZXing Library (producci√≥n) -->
    <script src="https://unpkg.com/@zxing/library@0.20.0"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì∑ Esc√°ner de Licencia USA - PDF417</h1>
            <p class="subtitle">Escanea el c√≥digo de barras en el reverso de la licencia</p>
        </header>

        <div class="main-content">
            <!-- Panel de c√°mara -->
            <div id="scannerPanel" class="scanner-panel active">
                <div class="camera-container">
                    <div class="camera-controls">
                        <button id="startButton" class="btn btn-primary">
                            ‚ñ∂ Iniciar C√°mara
                        </button>
                        <button id="stopButton" class="btn btn-secondary" disabled>
                            ‚èπ Detener
                        </button>
                        <select id="cameraSelect" class="camera-select" disabled>
                            <option value="">Seleccionar c√°mara...</option>
                        </select>
                        <div class="toggle-switch">
                            <input type="checkbox" id="tryHarderToggle" checked>
                            <label for="tryHarderToggle">Alta precisi√≥n</label>
                        </div>
                    </div>

                    <div class="video-wrapper">
                        <video id="videoElement" playsinline></video>
                        <div class="scan-frame">
                            <div class="scan-line"></div>
                            <div class="corner tl"></div>
                            <div class="corner tr"></div>
                            <div class="corner bl"></div>
                            <div class="corner br"></div>
                        </div>
                    </div>

                    <div class="status-display">
                        <div class="status-icon" id="statusIcon">üì∑</div>
                        <div class="status-text" id="statusText">Listo para escanear</div>
                        <div class="fps-counter" id="fpsCounter">0 FPS</div>
                    </div>

                    <canvas id="debugCanvas" style="display: none;"></canvas>
                </div>

                <div class="instructions">
                    <h3>üìã Instrucciones:</h3>
                    <ul>
                        <li>Usa la c√°mara trasera para mejor calidad</li>
                        <li>Mant√©n buena iluminaci√≥n</li>
                        <li>Aseg√∫rate de que el c√≥digo est√© dentro del marco</li>
                        <li>Evita reflejos en el pl√°stico de la licencia</li>
                        <li>Mant√©n la c√°mara estable</li>
                    </ul>
                </div>
            </div>

            <!-- Panel de resultados -->
            <div id="resultsPanel" class="results-panel" style="display: none;">
                <div class="results-header">
                    <h2>‚úÖ Licencia Escaneada</h2>
                    <button id="scanAgainButton" class="btn btn-success">
                        üîÑ Escanear otra
                    </button>
                </div>

                <div class="results-card">
                    <div class="license-data">
                        <h3>üìá Informaci√≥n Principal</h3>
                        <table class="data-table">
                            <tr>
                                <th>N√∫mero de Licencia:</th>
                                <td id="licenseNumber">-</td>
                            </tr>
                            <tr>
                                <th>Nombre Completo:</th>
                                <td id="fullName">-</td>
                            </tr>
                            <tr>
                                <th>Fecha de Nacimiento:</th>
                                <td id="birthDate">-</td>
                            </tr>
                            <tr>
                                <th>Fecha de Expiraci√≥n:</th>
                                <td id="expiryDate">-</td>
                            </tr>
                            <tr>
                                <th>Estado Emisor:</th>
                                <td id="state">-</td>
                            </tr>
                            <tr>
                                <th>Direcci√≥n:</th>
                                <td id="address">-</td>
                            </tr>
                        </table>
                    </div>

                    <div class="raw-data-section">
                        <h3>üìä Datos AAMVA Crudos</h3>
                        <div class="raw-data-controls">
                            <button id="copyRawData" class="btn btn-small">üìã Copiar</button>
                            <button id="toggleRawData" class="btn btn-small">üëÅÔ∏è Mostrar/Ocultar</button>
                        </div>
                        <pre id="rawData" class="raw-data"></pre>
                    </div>

                    <div class="validation-info">
                        <h3>üîç Informaci√≥n de Validaci√≥n</h3>
                        <div class="validation-grid">
                            <div class="validation-item">
                                <span class="validation-label">Formato V√°lido:</span>
                                <span id="formatValid" class="validation-value">‚ùì</span>
                            </div>
                            <div class="validation-item">
                                <span class="validation-label">Checksum:</span>
                                <span id="checksumValid" class="validation-value">‚ùì</span>
                            </div>
                            <div class="validation-item">
                                <span class="validation-label">Fecha Expiraci√≥n:</span>
                                <span id="expiryValid" class="validation-value">‚ùì</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="debug-panel">
            <h3>üêõ Informaci√≥n de Depuraci√≥n</h3>
            <div class="debug-info">
                <div>Estado C√°mara: <span id="debugCameraStatus">Inactiva</span></div>
                <div>Resoluci√≥n: <span id="debugResolution">-</span></div>
                <div>√öltimo Escaneo: <span id="debugLastScan">Nunca</span></div>
                <div>Intentos Fallidos: <span id="debugFailedAttempts">0</span></div>
            </div>
        </div>

        <footer>
            <p class="disclaimer">
                ‚ö†Ô∏è <strong>Uso Educativo:</strong> Esta herramienta procesa datos localmente.
                No se env√≠an datos a servidores externos. Cumple con las leyes de privacidad.
            </p>
        </footer>
    </div>

    <script src="scanner.js"></script>
</body>
</html>