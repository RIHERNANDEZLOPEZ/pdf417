<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Scan Licencia USA - BlinkID</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    video { width: 100%; max-width: 400px; border: 1px solid #ccc; }
    pre { background: #f5f5f5; padding: 10px; }
  </style>
</head>
<body>

<h2>Escaneo de licencia USA (frente)</h2>

<video id="camera" autoplay></video>
<br><br>
<button id="start">Iniciar escaneo</button>

<h3>Resultado</h3>
<pre id="result">Esperando...</pre>

<!-- BlinkID SDK (UMD build) -->
<script src="https://cdn.jsdelivr.net/npm/@microblink/blinkid-in-browser-sdk@6.1.0/dist/blinkid-sdk.min.js"></script>

<script>
(async () => {
  const resultEl = document.getElementById('result');
  const videoEl = document.getElementById('camera');

  // ⚠️ Reemplaza con tu license key
  const LICENSE_KEY = "TU_LICENSE_KEY_AQUI";

  document.getElementById('start').onclick = async () => {
    try {
      resultEl.textContent = "Inicializando BlinkID...";

      const sdk = await BlinkIDSDK.initialize({
        licenseKey: LICENSE_KEY,
        engineLocation: "/blinkid", // carpeta donde están los WASM
      });

      // Recognizer para documentos de identidad
      const recognizer = await sdk.createBlinkIdRecognizer();

      // Acceder a cámara
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" }
      });
      videoEl.srcObject = stream;

      resultEl.textContent = "Escaneando... apunta al frente de la licencia";

      // Escaneo continuo
      sdk.recognizeFromVideo(videoEl, recognizer, (result) => {
        if (result.state === BlinkIDSDK.RecognizerResultState.Valid) {

          const data = result.result;

          stream.getTracks().forEach(t => t.stop());

          resultEl.textContent = JSON.stringify({
            licenseNumber: data.documentNumber,
            firstName: data.firstName,
            lastName: data.lastName,
            dateOfBirth: data.dateOfBirth,
            expirationDate: data.dateOfExpiry,
            issuingState: data.issuingAuthority
          }, null, 2);
        }
      });

    } catch (err) {
      console.error(err);
      resultEl.textContent = "Error: " + err.message;
    }
  };
})();
</script>

</body>
</html>
